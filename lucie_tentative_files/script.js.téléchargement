const toggleButton = document.getElementById("toggleDrawer");
const drawer = document.querySelector(".drawer");
const overlay = document.querySelector(".drawer-overlay");

document.querySelectorAll(".drawer-btn").forEach((item) => {
  item.addEventListener("click", () => {
    drawer.classList.toggle("-translate-x-full");
    drawer.classList.toggle("-translate-x-0");
    overlay.classList.toggle("hidden");
  });
});

toggleButton.addEventListener("click", () => {
  drawer.classList.toggle("-translate-x-full");
  drawer.classList.toggle("-translate-x-0");
  overlay.classList.toggle("hidden");
});

overlay.addEventListener("click", () => {
  drawer.classList.toggle("-translate-x-full");
  drawer.classList.toggle("-translate-x-0");
  overlay.classList.toggle("hidden");
});

// SCROLL TO TOP BUTTON
document.addEventListener('DOMContentLoaded', function () {
  const scrollToTopBtn = document.getElementById('scrollToTopBtn');
  const footer = document.getElementById('footer');

  function adjustButtonPosition() {
    const footerRect = footer.getBoundingClientRect();
    const windowHeight = window.innerHeight || document.documentElement.clientHeight;

    if (window.innerWidth >= 1024 && footerRect.top <= windowHeight) {
      scrollToTopBtn.style.bottom = `${windowHeight - footerRect.top + 20}px`;
    } else {
      scrollToTopBtn.style.bottom = '24px';
    }
  }

  window.addEventListener('scroll', function () {
    if (window.scrollY > 200) {
      scrollToTopBtn.classList.remove('opacity-0');
      scrollToTopBtn.classList.add('opacity-100');
    } else {
      scrollToTopBtn.classList.remove('opacity-100');
      scrollToTopBtn.classList.add('opacity-0');
    }
    adjustButtonPosition();
  });

  scrollToTopBtn.addEventListener('click', function () {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  adjustButtonPosition();
});

// DROPDOWN LANGUE
const currentLang = window.location.pathname.split('/')[1] || 'fr';

const pageMap = {
  fr: {
    'index': '',
    'tarifs': 'tarifs',
    'preise': 'tarifs',
    'pricing': 'tarifs',
    'faq': 'faq',
    'legal': 'legal',
    'securite': 'securite',
    'sicherheit': 'securite',
    'security': 'securite'
  },
  de: {
    'index': '',
    'tarifs': 'preise',
    'pricing': 'preise',
    'faq': 'faq',
    'legal': 'legal',
    'securite': 'sicherheit',
    'security': 'sicherheit'
  },
  en: {
    'index': '',
    'tarifs': 'pricing',
    'preise': 'pricing',
    'faq': 'faq',
    'legal': 'legal',
    'securite': 'security',
    'sicherheit': 'security'
  }
};

const currentPage = window.location.pathname.split('/')[2] ? window.location.pathname.split('/')[2].replace('.html', '') : 'index';

function updateLanguageUrl(newLang) {
  const newPage = pageMap[newLang][currentPage] || 'index';
  const newUrl = `/${newLang}/${newPage === 'index' ? '' : `${newPage}.html`}`;
  window.location.href = newUrl;
}

document.querySelectorAll('.lang-link').forEach(link => {
  const lang = link.getAttribute('href').split('/')[1];
  if (lang === currentLang) {
    link.classList.add('active');
  } else {
    link.classList.remove('active');
  }

  link.addEventListener('click', function (e) {
    e.preventDefault();
    const newLang = this.getAttribute('href').split('/')[1];
    updateLanguageUrl(newLang);
  });
});

// FAQ
document.addEventListener('DOMContentLoaded', function () {
  const questions = document.querySelectorAll('.faq-question');

  questions.forEach(question => {
    question.addEventListener('click', function () {
      this.classList.toggle('active');
      const answer = this.nextElementSibling;
      answer.classList.toggle('show');
    });
  });
});

// RESTER INFORME
const wrap = document.querySelector(".notify-wrap");
const toggle = document.getElementById("notifyToggle");

toggle.addEventListener("click", () => {
  wrap.classList.toggle("open");
});

// ALTERNATING BANNER
document.addEventListener('DOMContentLoaded', function() {
    const banner = document.getElementById('alternating-banner');
    const closeBtn = document.getElementById('close-alternating-banner');

    // 1. Vérification si la bannière a déjà été fermée (via localStorage)
    if (localStorage.getItem('swissTranscriptBannerClosed') === 'true') {
        banner.style.display = 'none';
        return;
    }

    // 2. Fonctionnalité du bouton de fermeture
    closeBtn.addEventListener('click', function() {
        // Animation de fondu avant la disparition
        banner.style.opacity = '0';
        setTimeout(() => {
            banner.style.display = 'none';
        }, 500);

        // Enregistrer l'état fermé dans le navigateur
        localStorage.setItem('swissTranscriptBannerClosed', 'true');
    });
});

// BANNER CLOSE
const apiBanner = document.getElementById("apiBanner");
const apiClose = document.getElementById("apiClose");
const b2bBanner = document.getElementById("b2bBanner");
const b2bClose = document.getElementById("b2bClose");

if (apiClose) {
  apiClose.addEventListener("click", () => {
    apiBanner.style.display = "none";
  });
}

if (b2bClose) {
  b2bClose.addEventListener("click", () => {
    b2bBanner.style.display = "none";
  });
}

// HERO ANIMATION
function typeText(element, text, speed, callback) {
  let i = 0;
  element.style.opacity = '1';
  element.textContent = '';
  const interval = setInterval(() => {
    element.textContent += text[i];
    i++;
    if (i >= text.length) {
      clearInterval(interval);
      if (callback) callback();
    }
  }, speed);
}

document.addEventListener('DOMContentLoaded', () => {
  const line1 = document.getElementById('line1');
  const line2 = document.getElementById('line2');
  const line3 = document.getElementById('line3');
  const confidence = document.getElementById('confidence');
  const second = document.querySelector('.hero-second');
  const third = document.querySelector('.hero-third');
  const buttons = document.querySelector('.hero-buttons');

  // Buttons are visible
  const buttons = document.querySelector('.hero-buttons');

  // Start after title animation (1s delay)
  setTimeout(() => {
    line1.style.opacity = '0';
    line1.style.animation = 'slideInLeft 0.8s ease-out forwards';
    setTimeout(() => {
      line2.style.opacity = '0';
      line2.style.animation = 'slideInRight 0.8s ease-out forwards';
      setTimeout(() => {
        line3.style.opacity = '0';
        line3.style.animation = 'slideInLeft 0.8s ease-out forwards';
        setTimeout(() => {
          confidence.style.opacity = '0';
          confidence.style.animation = 'fadeInUp 0.8s ease-out forwards';
          setTimeout(() => {
            second.style.opacity = '0';
            second.style.animation = 'fadeInUp 0.8s ease-out forwards';
            third.style.opacity = '0';
            third.style.animation = 'fadeInUp 0.8s ease-out forwards';
          }, 800);
        }, 800);
      }, 800);
    }, 800);
  }, 1000);
});
